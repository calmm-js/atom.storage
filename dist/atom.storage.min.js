!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("infestines")):"function"==typeof define&&define.amd?define(["exports","infestines"],t):t((e.atom=e.atom||{},e.atom.storage={}),e.I)}(this,function(e,v){"use strict";var r=new WeakMap,m=function(e){var t=r.get(e);return t||r.set(e,t={}),t},y=function(e){try{return JSON.parse(e)}catch(e){return e}},p=function(e){return e&&e.constructor===Object&&"value"in e},u=function(e){var t=e.key;delete m(e.storage)[t]};e.unsafeDeleteAtom=u,e.expireNow=function(e){for(var t=e.storage,r=e.regex,n=e.unsafeDeleteAtoms,a=0;a<t.length;++a){var o=t.key(a);if(r.test(o)){var i=y(t.getItem(o));p(i)&&i.expires<=Date.now()&&(t.removeItem(o),n&&u({storage:t,key:o}))}}},e.default=function(e){var r=e.key,n=e.storage,t=function(e,t){var r={};for(var n in e)0<=t.indexOf(n)||Object.prototype.hasOwnProperty.call(e,n)&&(r[n]=e[n]);return r}(e,["key","storage"]),a=t.value,o=t.Atom,i=t.time,u=t.schema,s=t.debounce,c=m(n),f=c[r];if(!f){c[r]=f=o(function(e,t,r,n,a){var o=e.getItem(t);if(!o)return n;var i=y(o);return p(i)&&v.acyclicEqualsU(i.schema,r)&&!v.acyclicEqualsU(i.value,n)?(0<=a&&(i.expires=a+Date.now(),e.setItem(t,JSON.stringify(i))),i.value):(e.removeItem(t),n)}(n,r,u,a,i));var l=f.changes();0<=s&&(l=l.debounce(s)),l.onValue(function(e){if(v.acyclicEqualsU(e,a))n.removeItem(r);else{var t={value:e};void 0!==u&&(t.schema=u),0<=i&&(t.expires=i+Date.now()),n.setItem(r,JSON.stringify(t))}})}return f},Object.defineProperty(e,"__esModule",{value:!0})});
